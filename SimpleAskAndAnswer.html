<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI Model Demo</title>
</head>
<body>
    <h1>Ask a Question about Sana Commerce</h1>
    <p>
        Ask info about info from two topics <a target="_blank" href="https://support.sana-commerce.com/Content/Sana-User-Guide/Basics/Store-Information.htm?tocpath=Sana%20User%20Guide%7CBasics%7C_____1">Basics</a> and <a target="_blank" href="https://support.sana-commerce.com/Content/Sana-User-Guide/Ordering-and-Checkout/Ordering-Settings/Registration.htm?tocpath=Sana%20User%20Guide%7COrdering%20%2526%20Checkout%7COrdering%20Settings%7C_____1">Ordering Settings</a> from Sana help site
    </p>
    <form id="myform" action="https://script.google.com/macros/s/AKfycbyy7MD91e9dQpQ4vUhm26C3X07ZquBZ04njGwFVj5WivgZytJ00hr3lK0QZ6Kdjrerc9w/exec" method="post">
        <div>
            <textarea id="question" name="question" style="width: 300px;">What is Sana Commerce?</textarea><br/>
            <button id="doSubmit">Ask</button>
        </div>
        <h3>Response:</h3>
        <div id="responseArea"></div>
        <input type="hidden" id="answer" name="answer" />
        <input type="hidden" id="good" name="good" />

        <div id="feedback" style="display: none;">
            <p><i>How do you evaluate this answer?</i></p>
            <input type="button" id="feedbackGood" value="Good" />
            <input type="button" id="feedbackMaybe" value="I don't know" />
            <input type="button" id="feedbackBad" value="Bad" />
        </div>
        <div id="submittingFeedback" style="display: none;">
            <i>Submitting...</i>
        </div>
    </form>

    <script>
        const feedbackBlock = document.getElementById("feedback");
        const userInput = document.getElementById("question");
        userInput.select();
        userInput.addEventListener("keydown", function(event) {
            if (event.ctrlKey && event.key === "Enter") {
                askOpenAI();
            }
        });
        document.getElementById("doSubmit").onclick = function(){ askOpenAI(); return false; }
        document.getElementById("feedbackGood").onclick = function(){ return postFeedback('good'); }
        document.getElementById("feedbackMaybe").onclick = function(){ return postFeedback('maybe'); }
        document.getElementById("feedbackBad").onclick = function(){ return postFeedback('bad'); }

        function postFeedback(result){
            document.getElementById("good").value=result;
            feedbackBlock.style.display = "none";
            document.getElementById("submittingFeedback").style.display = "block";
            document.forms["myform"].submit();
            return false;
        }

        async function askOpenAI() {
            const userInput = document.getElementById("question").value;
            const responseArea = document.getElementById("responseArea");
            const answer = document.getElementById("answer");

            if (!userInput) {
                responseArea.innerHTML = "Please enter a question.";
                return;
            }

            responseArea.innerHTML = "Loading...";

            const auth = "Bearer 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";

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": auth
                    },
                    body: JSON.stringify({
                        model: "ft:gpt-4o-2024-08-06:personal:basicandorderingsettings:AMDG9X3o",
                        messages: [{"role": "user", "content": userInput}]
                    })
                });

                const data = await response.json();
                const message = data.choices[0].message.content;
                responseArea.innerHTML = message;
                answer.value = message;
                feedbackBlock.style.display = "block";
            } catch (error) {
                responseArea.innerHTML = "Error: " + error.message;
            }
        }


    </script>
</body>
</html>
